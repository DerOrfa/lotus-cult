namespace = slaver

#create docile slaves faction and pop pop in
pop_event = {
	id = "slaver.10"
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		owner = {
			if = {
			  # find existing docile faction
				limit = {
					any_owned_pop = {
						exists = pop_faction
						pop_faction = { is_pop_faction_type = docile_slaves }
					}
				}
				random_pop_faction = {
					limit = { is_pop_faction_type = docile_slaves }
					save_event_target_as = docile_faction
				}
				root = {set_pop_faction = event_target:docile_faction}

				else = {
					# Create docile Slaves pop faction and put me in
					root = {
						owner = {
							create_pop_faction = {
								type = docile_slaves
								parameter:owner_empire = this
								pop = root
							}
						}
					}
				}
			}
		}
	}
}

pop_event = {
		id = "slaver.100"
		hide_window = yes
		is_triggered_only = yes

		trigger = {
			not = {has_trait = natural_slavers} #don't enslave yourself
		}


		immediate = {
			enslave_pop = yes
			pop_remove_ethic = ethic_fanatic_individualist
			pop_remove_ethic = ethic_individualist
			pop_remove_ethic = ethic_fanatic_xenophobe
			pop_remove_ethic = ethic_xenophobe
			pop_remove_ethic = ethic_fanatic_militarist
			pop_remove_ethic = ethic_fanatic_pacifist
			pop_remove_ethic = ethic_fanatic_materialist

			if = {
				limit = { has_ethic = ethic_broken }
				pop_remove_ethic =  ethic_broken
				pop_add_ethic = ethic_mindless
				break = yes
			}
			pop_add_ethic =  ethic_broken
		}
}

pop_event = {
	id = "slaver.101"
#	title = "pop.1.name"
#	desc = "pop.1.desc"
#	picture = GFX_evt_cybernetics
	hide_window = yes

	trigger = {
		is_enslaved = no
		is_being_purged = no
		has_trait = natural_slavers
		planet = {
			any_pop = {
				not = {is_same_species = ROOT}
			}
		}
	}
	mean_time_to_happen = {	months = 12	}
	immediate = {
		planet = {
			random_pop = {
				limit = { not = {is_same_species = ROOT } }
				pop_event = {id=slaver.100}
				pop_event = {id=slaver.10}
			}
		}
	}
}


event = {
	id = slaver.1

	fire_only_once = yes
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = {
				has_trait = natural_slavers
			}
			every_owned_planet = {
				every_owned_pop = { kill_pop = yes } #make space
				every_tile = { # get some more space for my people
					limit = {
						has_blocker = yes
						has_resource = {  type = society_research amount = 1 }
					}
					remove_blocker = yes
				}
				every_tile = { # get my people back
					limit = {
						has_blocker = no
						OR = {
							has_resource = {  type = engineering_research amount = 1 }
							has_resource = {  type = society_research amount = 1 }
							has_resource = {  type = physics_research amount = 1 }
							has_resource = {  type = energy amount = 1 }
						}
					}
					create_pop = {
						species = owner_main_species
					}
				}

				# create servants
				create_species = { #we can do this, because we assume thre is only one planet
					name = "Servants"
					class = MAM
					portrait = human_male_01
					homeworld = THIS
					traits = {
						trait=trait_presentient_proles
						trait=trait_strong
#						trait=trait_agrarian
#						trait=trait_repugnant
					}
				}
				every_tile = {
					limit = {
						has_blocker = no
						OR = {
							has_resource = {  type = food amount = 1 }
							has_resource = {  type = minerals amount = 1 }
						}
						NOT = {
							has_resource = {  type = energy amount = 1 }
						}
					}

					create_pop = {
						species = Servants
					}
				}

				every_owned_pop = { #and enslave them
					limit = { is_species = Servants }
					pop_event = {id = slaver.100}
					pop_event = {id = slaver.10}
				}
			}
		}
	}
}
